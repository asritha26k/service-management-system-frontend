<div class="d-flex justify-content-between align-items-center mb-4">
      <h2>My Assigned Tasks</h2>
      <span class="badge bg-primary text-white">{{ tasks.length }} Tasks Total</span>
    </div>
    
    <div class="table-responsive">
      <table class="table table-hover shadow-sm rounded overflow-hidden">
        <thead class="table-light">
          <tr>
            <th>Request #</th>
            <th>Service</th>
            <th>Customer</th>
            <th>Address</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Schedule</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (task of tasks; track task.id) {
          <tr>
            <td class="fw-bold">{{ task.requestNumber || task.id.substring(0, 8) }}</td>
            <td>
              <div class="fw-bold">{{ task.serviceName || 'Service Request' }}</div>
              <div class="small text-muted text-truncate" style="max-width: 200px;" [title]="task.issueDetails || ''">
                {{ task.issueDetails }}
              </div>
            </td>

            <td>
              <div>{{ task.customerDetails?.name || 'Customer' }}</div>
              <small class="text-muted">{{ task.customerDetails?.email }}</small>
            </td>
            <td class="small">{{ task.address }}</td>
            <td>
               <span class="badge rounded-pill" [ngClass]="getPriorityClass(task.priority)">{{ task.priority }}</span>
            </td>
            <td>
               <span class="badge rounded-pill" [ngClass]="getStatusClass(task.status)">{{ task.status }}</span>
            </td>
            <td>
              <div class="small">{{ task.preferredDate | date:'medium' }}</div>
            </td>
            <td>
              @if (task.status === 'ASSIGNED') {
                <div class="d-flex gap-1">
                  <button class="btn btn-sm btn-success" (click)="acceptRequest(task)">
                    <i class="bi bi-check-circle me-1"></i> Accept
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="openRejectModal(task)">
                    <i class="bi bi-x-circle me-1"></i> Reject
                  </button>
                </div>
              } @else if (task.status !== 'COMPLETED' && task.status !== 'CANCELLED' && task.status !== 'CLOSED') {
                <button class="btn btn-sm btn-outline-primary" (click)="updateStatus(task)">
                  <i class="bi bi-pencil-square me-1"></i> Update
                </button>
              }
            </td>
          </tr>
          } @empty {
          <tr>
            <td colspan="8" class="text-center py-5">
              <i class="bi bi-inbox display-4 d-block mb-2 text-muted"></i>
              No assigned tasks found.
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

     <!-- Status Update Modal -->
     @if (selectedTask) {
     <div class="modal d-block" style="background: rgba(0,0,0,0.5); z-index: 1050;">
       <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content border-0 shadow-lg">
           <div class="modal-header bg-light">
             <h5 class="modal-title">Update Status: {{ selectedTask.requestNumber }}</h5>
             <button type="button" class="btn-close" (click)="selectedTask = null"></button>
           </div>
           <div class="modal-body p-4">
             <label class="form-label fw-bold">Select New Status</label>
             <select class="form-select form-select-lg" #statusSelect [value]="selectedTask.status">
               <option value="IN_PROGRESS">In Progress</option>
               <option value="COMPLETED">Completed</option>
             </select>
             <div class="mt-3 small text-muted">
               Updating this status will be visible to the customer and manager.
             </div>
           </div>
           <div class="modal-footer bg-light border-0">
             <button class="btn btn-link text-secondary text-decoration-none" (click)="selectedTask = null">Cancel</button>
             <button class="btn btn-primary px-4" (click)="saveStatus(selectedTask.id, statusSelect.value)">
               Save Changes
             </button>
           </div>
         </div>
       </div>
     </div>
     }

     <!-- Reject Modal -->
     @if (rejectTask) {
     <div class="modal d-block" style="background: rgba(0,0,0,0.5); z-index: 1050;">
       <div class="modal-dialog modal-dialog-centered">
         <div class="modal-content border-0 shadow-lg">
           <div class="modal-header bg-danger text-white">
             <h5 class="modal-title">Reject Request: {{ rejectTask.requestNumber }}</h5>
             <button type="button" class="btn-close btn-close-white" (click)="closeRejectModal()"></button>
           </div>
           <div class="modal-body p-4">
             <label class="form-label fw-bold">Reason for Rejection</label>
             <textarea 
               class="form-control" 
               rows="4" 
               [(ngModel)]="rejectReason"
               placeholder="Please provide a reason for rejecting this request..."
               [ngClass]="{'is-invalid': showRejectError}"></textarea>
             @if (showRejectError) {
               <div class="invalid-feedback d-block">
                 Reason is required to reject a request.
               </div>
             }
             <div class="mt-3 small text-muted">
               The customer and manager will be notified of this rejection.
             </div>
           </div>
           <div class="modal-footer bg-light border-0">
             <button class="btn btn-link text-secondary text-decoration-none" (click)="closeRejectModal()">Cancel</button>
             <button class="btn btn-danger px-4" (click)="confirmReject()">
               Reject Request
             </button>
           </div>
         </div>
       </div>
     </div>
     }