<div class="row justify-content-center">
   <div class="col-lg-12">
      <p class="text-muted mb-4">Join our team of expert technicians. Please fill out the form below.</p>

      <form [formGroup]="form" (ngSubmit)="onSubmit()">

         <h5 class="mb-3 border-bottom pb-2 fw-bold text-primary">Personal Information</h5>
         <div class="row">
            <div class="col-md-6 mb-3">
               <label class="form-label fw-bold">Full Name</label>
               <input type="text" class="form-control" formControlName="fullName" placeholder="John Doe">
               @if (isInvalid('fullName')) {
               <div class="invalid-feedback d-block">
                  @if (form.get('fullName')?.errors?.['required']) {
                  Full name is required.
                  } @else if (form.get('fullName')?.errors?.['alphaWithSpaces']) {
                  Name must contain only letters and spaces.
                  } @else if (form.get('fullName')?.errors?.['whitespace']) {
                  Name cannot be only spaces.
                  }
               </div>
               }
            </div>
            <div class="col-md-6 mb-3">
               <label class="form-label fw-bold">Email</label>
               <input type="email" class="form-control" formControlName="email" placeholder="john@example.com">
               <div class="invalid-feedback d-block" [class.d-none]="!isInvalid('email')">Please provide a valid email.
               </div>
            </div>
            <div class="col-md-6 mb-3">
               <label class="form-label fw-bold">Phone</label>
               <input type="text" class="form-control" formControlName="phone" placeholder="+1 234 567 8900">
               <div class="invalid-feedback d-block" [class.d-none]="!isInvalid('phone')">Required (10-12 digits).</div>
            </div>
         </div>

         <div class="mb-3">
            <label class="form-label fw-bold">Address</label>
            <textarea class="form-control" formControlName="address" rows="2" placeholder="Street Address"></textarea>
            @if (isInvalid('address')) {
            <div class="invalid-feedback d-block">
               @if (form.get('address')?.errors?.['required']) {
               Address is required.
               } @else if (form.get('address')?.errors?.['invalidAddress']) {
               Address contains invalid characters.
               } @else if (form.get('address')?.errors?.['whitespace']) {
               Address cannot be only spaces.
               }
            </div>
            }
         </div>

         <div class="row">
            <div class="col-md-4 mb-3">
               <label class="form-label fw-bold">City</label>
               <input type="text" class="form-control" formControlName="city">
               @if (isInvalid('city')) {
               <div class="invalid-feedback d-block">
                  @if (form.get('city')?.errors?.['required']) {
                  City is required.
                  } @else if (form.get('city')?.errors?.['alphabeticOnly']) {
                  City must contain only letters (no spaces, numbers, or special characters).
                  } @else if (form.get('city')?.errors?.['whitespace']) {
                  City cannot be only spaces.
                  }
               </div>
               }
            </div>
            <div class="col-md-4 mb-3">
               <label class="form-label fw-bold">State</label>
               <input type="text" class="form-control" formControlName="state">
               @if (isInvalid('state')) {
               <div class="invalid-feedback d-block">
                  @if (form.get('state')?.errors?.['required']) {
                  State is required.
                  } @else if (form.get('state')?.errors?.['alphabeticOnly']) {
                  State must contain only letters (no spaces, numbers, or special characters).
                  } @else if (form.get('state')?.errors?.['whitespace']) {
                  State cannot be only spaces.
                  }
               </div>
               }
            </div>
            <div class="col-md-4 mb-3">
               <label class="form-label fw-bold">Zip Code</label>
               <input type="text" class="form-control" formControlName="zipCode">
               <div class="invalid-feedback d-block" [class.d-none]="!isInvalid('zipCode')">Required (6 digits).</div>
            </div>
         </div>

         <h5 class="mt-4 mb-3 border-bottom pb-2 fw-bold text-primary">Professional Details</h5>
         <div class="row">
            <div class="col-md-6 mb-3">
               <label class="form-label fw-bold">Experience (Years)</label>
               <input type="number" class="form-control" formControlName="experience" min="1">
               <div class="invalid-feedback d-block" [class.d-none]="!isInvalid('experience')">
                  @if (form.get('experience')?.errors?.['required']) {
                  Experience is required.
                  } @else if (form.get('experience')?.errors?.['min']) {
                  Minimum 1 year of experience required.
                  }
               </div>
            </div>
            <div class="col-md-6 mb-3">
               <label class="form-label fw-bold">Specialization</label>
               <select class="form-select" formControlName="specialization">
                  <option value="">Select...</option>
                  <option value="PLUMBING">Plumbing</option>
                  <option value="ELECTRICAL">Electrical</option>
                  <option value="HVAC">HVAC</option>
                  <option value="APPLIANCE">Appliance Repair</option>
                  <option value="OTHER">Other</option>
               </select>
               @if (isInvalid('specialization')) {
               <div class="invalid-feedback d-block">
                  @if (form.get('specialization')?.errors?.['required']) {
                  Specialization is required.
                  } @else if (form.get('specialization')?.errors?.['alphanumericWithSpaces']) {
                  Specialization contains invalid characters.
                  } @else if (form.get('specialization')?.errors?.['whitespace']) {
                  Specialization cannot be only spaces.
                  }
               </div>
               }
            </div>
         </div>

         <div class="mb-3">
            <label class="form-label fw-bold">Skills (Comma separated)</label>
            <input type="text" class="form-control" placeholder="e.g. Wiring, Pipe Fitting, Installation" #skillsInput
               (blur)="updateSkills(skillsInput.value)">
            <small class="text-muted">Current skills: {{ skillsFormArray.value.join(', ') || 'None added' }}</small>
         </div>

         <div class="mb-3">
            <label class="form-label fw-bold">Certifications <span class="text-muted small">(Optional)</span></label>
            <input type="text" class="form-control" formControlName="certifications">
            @if (form.get('certifications')?.touched && form.get('certifications')?.invalid) {
            <div class="invalid-feedback d-block">
               @if (form.get('certifications')?.errors?.['minlength']) {
               Certifications must be at least 3 characters if provided.
               } @else if (form.get('certifications')?.errors?.['alphanumericWithSpaces']) {
               Certifications contain invalid characters.
               }
            </div>
            }
         </div>

         <div class="mb-3">
            <label class="form-label fw-bold">Previous Employer <span class="text-muted small">(Optional)</span></label>
            <input type="text" class="form-control" formControlName="previousEmployer">
            @if (form.get('previousEmployer')?.touched && form.get('previousEmployer')?.invalid) {
            <div class="invalid-feedback d-block">
               @if (form.get('previousEmployer')?.errors?.['minlength']) {
               Employer name must be at least 2 characters if provided.
               } @else if (form.get('previousEmployer')?.errors?.['alphabeticOnly']) {
               Employer name must contain only letters (no spaces, numbers, or special characters).
               }
            </div>
            }
         </div>

         <div class="mb-3">
            <label class="form-label fw-bold">Work Experience Details <span
                  class="text-muted small">(Optional)</span></label>
            <textarea class="form-control" formControlName="workExperienceDetails" rows="3"></textarea>
            @if (form.get('workExperienceDetails')?.touched && form.get('workExperienceDetails')?.invalid) {
            <div class="invalid-feedback d-block">
               @if (form.get('workExperienceDetails')?.errors?.['minlength']) {
               Experience details must be at least 10 characters if provided.
               } @else if (form.get('workExperienceDetails')?.errors?.['alphanumericWithSpaces']) {
               Experience details contain invalid characters.
               } @else if (form.get('workExperienceDetails')?.errors?.['whitespace']) {
               Experience details cannot be only spaces.
               }
            </div>
            }
         </div>

         <h5 class="mt-4 mb-3 border-bottom pb-2 fw-bold text-primary">Availability & Preferences</h5>
         <div class="row">
            <div class="col-md-6 mb-3">
               <label class="form-label fw-bold">Max Concurrent Jobs</label>
               <input type="number" class="form-control" formControlName="maxWorkload">
            </div>
            <div class="col-md-6 mb-3 d-flex align-items-center gap-4 pt-4">
               <div class="form-check">
                  <input class="form-check-input" type="checkbox" formControlName="hasVehicle">
                  <label class="form-check-label">Has Vehicle</label>
               </div>
               <div class="form-check">
                  <input class="form-check-input" type="checkbox" formControlName="hasToolkit">
                  <label class="form-check-label">Has Toolkit</label>
               </div>
            </div>
         </div>

         <div class="mb-3">
            <label class="form-label fw-bold">Availability (Days/Hours) <span
                  class="text-muted small">(Optional)</span></label>
            <input type="text" class="form-control" formControlName="availability" placeholder="e.g. Mon-Fri 9-5">
            @if (form.get('availability')?.touched && form.get('availability')?.invalid) {
            <div class="invalid-feedback d-block">
               @if (form.get('availability')?.errors?.['minlength']) {
               Availability must be at least 3 characters if provided.
               } @else if (form.get('availability')?.errors?.['alphanumericWithSpaces']) {
               Availability contains invalid characters.
               }
            </div>
            }
         </div>

         <h5 class="mt-4 mb-3 border-bottom pb-2 fw-bold text-primary">Emergency Contact</h5>
         <div class="row">
            <div class="col-md-6 mb-3">
               <label class="form-label fw-bold">Contact Name <span class="text-muted small">(Optional)</span></label>
               <input type="text" class="form-control" formControlName="emergencyContactName">
               @if (form.get('emergencyContactName')?.touched && form.get('emergencyContactName')?.invalid) {
               <div class="invalid-feedback d-block">
                  @if (form.get('emergencyContactName')?.errors?.['minlength']) {
                  Name must be at least 2 characters.
                  } @else if (form.get('emergencyContactName')?.errors?.['alphaWithSpaces']) {
                  Name should only contain letters and spaces.
                  }
               </div>
               }
            </div>
            <div class="col-md-6 mb-3">
               <label class="form-label fw-bold">Contact Phone <span class="text-muted small">(Optional)</span></label>
               <input type="text" class="form-control" formControlName="emergencyContactPhone">
               @if (form.get('emergencyContactPhone')?.touched &&
               form.get('emergencyContactPhone')?.errors?.['pattern']) {
               <div class="invalid-feedback d-block">Phone must be 10-12 digits.</div>
               }
            </div>
         </div>

         <div class="mb-4">
            <label class="form-label fw-bold">Motivation For Joining <span
                  class="text-muted small">(Optional)</span></label>
            <textarea class="form-control" formControlName="motivation" rows="3"></textarea>
            @if (form.get('motivation')?.touched && form.get('motivation')?.invalid) {
            <div class="invalid-feedback d-block">
               @if (form.get('motivation')?.errors?.['minlength']) {
               Motivation must be at least 10 characters if provided.
               } @else if (form.get('motivation')?.errors?.['alphanumericWithSpaces']) {
               Motivation contains invalid characters.
               } @else if (form.get('motivation')?.errors?.['whitespace']) {
               Motivation cannot be only spaces.
               }
            </div>
            }
         </div>

         <div class="d-flex flex-column gap-2">
            <button type="submit" class="btn btn-primary btn-lg" [disabled]="form.invalid || isSubmitting">
               {{ isSubmitting ? 'Submitting...' : 'Submit Application' }}
            </button>
            <button type="button" class="btn btn-outline-secondary" (click)="goHome()">Cancel</button>
         </div>

      </form>
   </div>
</div>